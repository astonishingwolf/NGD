# ============================================================================
# MonoClothRecon Configuration File
# Dataset: Dress4D - Demo - Monocular Synthetic - Upper Garment
# ============================================================================

# Global Settings
gpu: 0
seed: 99

timeloop:
  # ========================================================================
  # Model Configuration
  # ========================================================================
  model_type: Dress4D
  model: general  # Options: hashgrid, hashgrid_vd, general, diffusion
  hidden_layers: 3
  batch_size: 1
  device: cuda:0
  
  # ========================================================================
  # Dataset Configuration
  # ========================================================================
  start_frame: 0
  end_frame: 100
  skip_frames: 1
  image_size: 1080
  
  # ========================================================================
  # Input Paths
  # ========================================================================
  # SMPL Model and Fittings
  smpl_path: /home/nakul/soham/3d/fixnormalndepth/SMPL_NEUTRAL.pkl
  smpl_pkl: /hdd_data/nakul/soham/Dataset/Dress4D/Demo/smpl/combined_smpl_camera.pkl
  template_smpl_pkl: null
  custom_template: false
  
  # Mesh Template
  mesh: /hdd_data/nakul/soham/Template_dir/Tshirt/tshirt.obj
  
  # Target Images and Masks
  target_images: /hdd_data/nakul/soham/Dataset/Dress4D/Demo/upper_cloth/textured_seg
  target_diffuse_maps: /hdd_data/nakul/soham/Dataset/Dress4D/Demo/upper_cloth/diffuse_seg
  target_shil_maps: /hdd_data/nakul/soham/Dataset/Dress4D/Demo/upper_cloth/shil
  target_shil_seg_maps: /hdd_data/nakul/soham/Dataset/Dress4D/Demo/upper_cloth/shil_seg
  target_complete_shil_maps: /hdd_data/nakul/soham/Dataset/Dress4D/Demo/human/shil
  target_hand_mask: /hdd_data/nakul/soham/Dataset/People_Snapshot/female-3-casual/hands_mask
  target_depth: null
  target_normal: null
  
  # ========================================================================
  # Training Configuration
  # ========================================================================
  num_epochs: 1200
  warm_ups: 300
  warm_ups_remesh: 400
  remesh_freq: 200
  
  # Learning Rate Schedules
  position_lr_init: 0.0003
  position_lr_final: 0.00000016
  position_lr_delay_mult: 0.01
  position_lr_max_steps: 100000
  deform_lr_max_steps: 140000
  custom_training_cannonical: true
  
  # Data Augmentation
  pose_noise: false
  noise_level: 0.002
  vertex_noise: true
  
  # Optimization
  skinning_func: rbf  # Options: rbf, k-near
  gradient_clipping: true
  stop_train_after_warmup: true
  
  # ========================================================================
  # Remeshing Configuration
  # ========================================================================
  remeshing: true
  remesh_stop: 750
  remesh_percentile: 0.9
  max_verts: 15000
  start_edge_len: 0.01
  end_edge_len: 0.007
  start_percentile: 0.85
  end_percentile: 0.95
  retriangulate: 0
  create_new_optimizer: false
  interpolate_new_optimizer: true
  
  # ========================================================================
  # Loss Configuration
  # ========================================================================
  losses:
    RenderingLoss: 5.0
    Regularization: 0.0
    StVKLoss: 1.0
    BendingLoss: 1.0
    DepthDistillation: 0.0  # Disabled when target_depth is null
  
  # ========================================================================
  # Logging Configuration
  # ========================================================================
  logging: false
  log_interval: 5
  log_interval_im: 150
  log_elev: 0
  log_fov: 60.0
  log_dist: 3.0
  log_res: 512
  log_light_power: 3.0
  
  # ========================================================================
  # Output Configuration
  # ========================================================================
  output_path: /hdd_data/nakul/soham/CVPR_Results/Demo/upper
  Exp_name: Remeshed
  save_instance: true
  save_index: 75
  save_freq: 100
  
  # ========================================================================
  # Texture Configuration
  # ========================================================================
  texture_recon: true
  texture_model: hashgrid_base  # Options: hashgrid_base, hashgrid_reg
  texture_map: [1024, 1024]
  max_mip_level: 3
  tex_epochs: 1000
  texture_warm_ups: 300
  use_dynamic_texture: true
  texture_lr_init: 0.0016
  texture_lr_final: 0.000016
  texture_lr_delay_mult: 0.01
  texture_lr_max_steps: 100000
  spatial_lr_scale: 5
  ssim_coeff: 0.001
  texture_lr_base: 0.002
  texture_lr_base_dyn: 0.002
